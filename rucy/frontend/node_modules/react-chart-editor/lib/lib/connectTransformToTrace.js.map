{"version":3,"sources":["../../src/lib/connectTransformToTrace.js"],"names":["connectTransformToTrace","WrappedComponent","TransformConnectedComponent","props","context","deleteTransform","bind","updateTransform","setLocals","nextProps","nextContext","transformIndex","container","fullContainer","transforms","fullTransforms","getValObject","attr","updateContainer","deleteContainer","update","newUpdate","key","newkey","onUpdate","type","DELETE_TRANSFORM","payload","traceIndex","index","displayName","propTypes","number","isRequired","contextTypes","object","data","array","func","childContextTypes","plotly_editor_traits"],"mappings":"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","file":"connectTransformToTrace.js","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {getDisplayName} from '../lib';\nimport {EDITOR_ACTIONS} from './constants';\n\nexport default function connectTransformToTrace(WrappedComponent) {\n  class TransformConnectedComponent extends Component {\n    constructor(props, context) {\n      super(props, context);\n\n      this.deleteTransform = this.deleteTransform.bind(this);\n      this.updateTransform = this.updateTransform.bind(this);\n      this.setLocals(props, context);\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n      this.setLocals(nextProps, nextContext);\n    }\n\n    setLocals(props, context) {\n      const {transformIndex} = props;\n      const {container, fullContainer} = context;\n\n      const transforms = container.transforms || [];\n      const fullTransforms = fullContainer.transforms || [];\n      this.container = transforms[transformIndex];\n      this.fullContainer = fullTransforms[transformIndex];\n    }\n\n    getChildContext() {\n      return {\n        getValObject: attr =>\n          !this.context.getValObject\n            ? null\n            : this.context.getValObject(`transforms[].${attr}`),\n        updateContainer: this.updateTransform,\n        deleteContainer: this.deleteTransform,\n        container: this.container,\n        fullContainer: this.fullContainer,\n      };\n    }\n\n    updateTransform(update) {\n      const newUpdate = {};\n      const {transformIndex} = this.props;\n      for (const key in update) {\n        const newkey = `transforms[${transformIndex}].${key}`;\n        newUpdate[newkey] = update[key];\n      }\n      this.context.updateContainer(newUpdate);\n    }\n\n    deleteTransform() {\n      if (this.context.onUpdate) {\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.DELETE_TRANSFORM,\n          payload: {\n            traceIndex: this.context.fullContainer.index,\n            transformIndex: this.props.transformIndex,\n          },\n        });\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  TransformConnectedComponent.displayName = `TransformConnected${getDisplayName(\n    WrappedComponent\n  )}`;\n\n  TransformConnectedComponent.propTypes = {\n    transformIndex: PropTypes.number.isRequired,\n  };\n\n  TransformConnectedComponent.contextTypes = {\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    data: PropTypes.array,\n    onUpdate: PropTypes.func,\n    updateContainer: PropTypes.func,\n    getValObject: PropTypes.func,\n  };\n\n  TransformConnectedComponent.childContextTypes = {\n    updateContainer: PropTypes.func,\n    deleteContainer: PropTypes.func,\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    getValObject: PropTypes.func,\n  };\n\n  const {plotly_editor_traits} = WrappedComponent;\n  TransformConnectedComponent.plotly_editor_traits = plotly_editor_traits;\n\n  return TransformConnectedComponent;\n}\n"]}